<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BIRRA CAST Achadinhos</title>

  <!-- Fonte Sour Gummy -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sour+Gummy&display=swap" rel="stylesheet">

  <style>
    :root { --bg:#000; --text:#f0f0f0; --muted:#999; }

    body {
      font-family: 'Sour Gummy', cursive;
      padding: 24px;
      color: var(--text);
      min-height: 100vh;
      background:
        url("background.png") center top / cover no-repeat fixed,
        linear-gradient(to bottom, #111111, #333333);
    }

    header { text-align:center; margin-bottom: 28px; }
    .status { text-align:center; margin: 18px 0; color: var(--muted); }

    /* --- BOTÕES DE CATEGORIA --- */
    #category-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    #category-buttons button {
      background: orange;
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-family: 'Sour Gummy', cursive;
      font-size: 15px;
      transition: transform 0.2s, background 0.2s;
    }

    #category-buttons button:hover {
      background: #ffa733;
      transform: scale(1.05);
    }

    #category-buttons button.active {
      background: #fff;
      color: orange;
      border: 2px solid orange;
    }

    /* Caixa de pesquisa */
    #search-box {
      display: block;
      margin: 0 auto 20px auto;
      padding: 10px 14px;
      font-size: 16px;
      width: 90%;
      max-width: 400px;
      border-radius: 8px;
      border: 2px solid orange;
      text-align: center;
      outline: none;
    }

    /* --- CONTÊINER GRID --- */
    #produtos {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 50px;
      margin-top: 20px;
      align-items: stretch;
    }

    @media (min-width: 600px) {
      #produtos {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
    }

    /* --- CARD DO PRODUTO --- */
    .produto {
      background: #fff;
      border: 4px solid orange;
      border-radius: 12px;
      padding: 12px;
      margin: 0;
      box-shadow: 0 4px 10px rgba(0,0,0,.06);
      color: #000;
      font-family: 'Sour Gummy', cursive;
      width: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .produto h2 {
      margin: 0 0 8px;
      font-size: 18px;
      color: #000;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .produto img.produto-img {
      max-width: 160px;
      max-height: 160px;
      display: block;
      margin: 0 auto 10px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .links {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .links a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #ddd;
      overflow: hidden;
      transition: transform .2s, box-shadow .2s;
    }

    .links a:hover { transform: scale(1.07); box-shadow: 0 6px 14px rgba(0,0,0,.18); }

    .links img {
      width: 80%;
      height: 80%;
      object-fit: contain;
    }

    .hidden { display:none; }

    .top-banner {
      width: 100%;
      text-align: center;
    }

    .top-banner img {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <div class="top-banner">
    <img src="poster3.PNG" alt="Poster Birra Cast">
  </div>

  <header></header>

  <!-- Botões de categoria -->
  <div id="category-buttons"></div>

  <!-- Caixa de pesquisa -->
  <input type="text" id="search-box" placeholder="Pesquisar produtos..." />

  <div id="status" class="status">Carregando produtos…</div>
  <div id="produtos"></div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQQe0VCTsh6KYIJ54EjpnqppZaTxZhmZ0d9kWf31SkSkO6RQxYcVg7TOx6GNB2PyGDP581EmW6ogph/pub?gid=0&single=true&output=csv";

    const COLS = {
      produto: ["Produto","produto","Nome","Título","Titulo"],
      imagem:  ["LinkDaImagem","Imagem","Foto","LinkImagem"],
      amazon:  ["LinkAmazon","Amazon"],
      ml:      ["LinkMercadoLivr","LinkMercadoLivre","MercadoLivre","ML"],
      shopee:  ["LinkShopee","Shopee"],
      categoria: ["Categoria","Categorias","Tags"]
    };

    const get = (row, keys) => {
      for (const k of keys) {
        const foundKey = Object.keys(row).find(h => h.trim() === k);
        if (foundKey && String(row[foundKey]).trim()) return String(row[foundKey]).trim();
      }
      return "";
    };

    let allCards = [];
    let allCategories = new Set();

    Papa.parse(sheetUrl, {
      download: true,
      header: true,
      skipEmptyLines: "greedy",
      complete: function (results) {
        const container = document.getElementById("produtos");
        const status = document.getElementById("status");

        const rows = results.data.map(r => {
          const clean = {};
          Object.keys(r).forEach(k => clean[k.trim()] = r[k]);
          return clean;
        }).filter(r => Object.values(r).some(v => String(v).trim()));

        rows.forEach(item => {
          const nome = get(item, COLS.produto);
          if (!nome) return;
          const img = get(item, COLS.imagem);
          const az = get(item, COLS.amazon);
          const ml = get(item, COLS.ml);
          const sp = get(item, COLS.shopee);
          const categorias = get(item, COLS.categoria)
            .split(";")
            .map(c => c.trim().toLowerCase())
            .filter(c => c);

          categorias.forEach(c => allCategories.add(c));

          const card = document.createElement("div");
          card.className = "produto";

          const imgBlock = img ? `<img src="${img}" alt="${nome}" class="produto-img">` : "";

          card.innerHTML = `
            <h2>${nome}</h2>
            ${imgBlock}
            <div class="links">
              <p style="width:100%; text-align:center; font-weight:bold; margin:10px 0;">Compre aqui:</p>
              ${az ? `<a href="${az}" target="_blank" rel="noopener"><img src="amazon_icon.jpg" alt="Amazon"></a>` : ""}
              ${ml ? `<a href="${ml}" target="_blank" rel="noopener"><img src="mercadolivre_icon.png" alt="Mercado Livre"></a>` : ""}
              ${sp ? `<a href="${sp}" target="_blank" rel="noopener"><img src="shopee_icon.png" alt="Shopee"></a>` : ""}
              <p style="font-size:12px; color:#555; margin-top:10px; line-height:1.3;">
              Foto meramente ilustrativa. Podem haver variações nos produtos, confira nas lojas antes de efetuar a compra.
              </p>
            </div>
          `;

          container.appendChild(card);
          allCards.push({ element: card, name: nome.toLowerCase(), categories: categorias });
        });

        createCategoryButtons();
        status.classList.add("hidden");
      },
      error: function(err) {
        document.getElementById("status").textContent = "Erro ao carregar a planilha: " + (err && err.message ? err.message : "verifique o link do CSV publicado");
      }
    });

    // --- Criação automática dos botões ---
    function createCategoryButtons() {
      const area = document.getElementById("category-buttons");
      const sorted = Array.from(allCategories).sort((a, b) => a.localeCompare(b));

      sorted.forEach(cat => {
        const btn = document.createElement("button");
        btn.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
        btn.addEventListener("click", () => filterByCategory(cat, btn));
        area.appendChild(btn);
      });
    }

    // --- Filtro por categoria ---
    function filterByCategory(category, btn) {
      document.querySelectorAll("#category-buttons button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      document.getElementById("search-box").value = category; // Preenche a busca também

      allCards.forEach(c => {
        if (c.categories.includes(category)) {
          c.element.style.display = "flex";
        } else {
          c.element.style.display = "none";
        }
      });
    }

    // --- Filtro pelo campo de busca ---
    const searchBox = document.getElementById("search-box");
    searchBox.addEventListener("input", function() {
      const query = this.value.toLowerCase();
      document.querySelectorAll("#category-buttons button").forEach(b => b.classList.remove("active"));
      allCards.forEach(c => {
        if (c.name.includes(query) || c.categories.some(cat => cat.includes(query))) {
          c.element.style.display = "flex";
        } else {
          c.element.style.display = "none";
        }
      });
    });
  </script>
</body>
</html>
